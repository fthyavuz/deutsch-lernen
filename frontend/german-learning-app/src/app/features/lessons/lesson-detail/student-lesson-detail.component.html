<div class="lesson-view">
    <div class="header-overlay">
        <button class="back-btn" (click)="goBack()">‚Üê</button>
        <div class="progress-pill">
            {{ currentIndex() + 1 }} / {{ vocabularies().length }}
        </div>
    </div>

    @if (loading()) {
    <div class="full-center">
        <div class="spinner"></div>
        <p>Preparing words...</p>
    </div>
    } @else if (vocabularies().length === 0) {
    <div class="full-center">
        <p>No words in this lesson yet.</p>
    </div>
    } @else {
    <div class="shorts-container" (scroll)="onScroll($event)">
        @for (vocabulary of vocabularies(); track vocabulary.id; let i = $index) {
        <div class="snap-section" [id]="'card-' + i">
            <app-flashcard [vocabulary]="vocabulary" [isActive]="currentIndex() === i"></app-flashcard>
        </div>
        }

        <!-- Finished State at the end of scroll -->
        <div class="snap-section finished-slide">
            <div class="finished-card">
                <div class="icon">üèÜ</div>
                <h2>Lesson Complete!</h2>
                <p>You've reviewed all {{ vocabularies().length }} words.</p>
                <div class="slide-actions">
                    <button (click)="restart()" class="btn-refresh">Review Again</button>
                    <button (click)="startQuiz()" class="btn-primary">Take Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tooltip for desktop/buttons -->
    @if (!finished()) {
    <div class="side-nav">
        <button class="nav-arrow up" (click)="prev()" [disabled]="currentIndex() === 0">‚Üë</button>
        <button class="nav-arrow down" (click)="next()">‚Üì</button>
    </div>
    }
    }
</div>